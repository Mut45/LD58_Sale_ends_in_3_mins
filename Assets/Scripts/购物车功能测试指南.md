# 购物车功能测试指南

## 功能概述
购物车系统已经实现，支持添加游戏到购物车、移除游戏、清空购物车等功能。

## 核心脚本
1. **ShoppingCart.cs** - 购物车核心逻辑
2. **GameCard.cs** - 游戏卡片，包含"加入购物车"按钮
3. **CartPageUI.cs** - 购物车页面UI
4. **CartItemUI.cs** - 购物车项目UI
5. **CartTestHelper.cs** - 测试助手脚本

## 测试步骤

### 1. 场景设置
确保以下场景已正确配置：
- `Shop_Page.unity` - 商城页面
- `Cart_Page.unity` - 购物车页面

### 2. 必需的游戏对象
在 `Shop_Page` 场景中需要：
- `GameSceneManager` 对象（用于场景切换）
- `ShoppingCart` 对象（购物车管理器）
- `StoreUI` 脚本（商城UI管理器）
- 多个 `GameCard` 对象（游戏卡片）

### 3. 测试购物车功能

#### 方法一：使用游戏卡片测试
1. 运行游戏，进入 `Shop_Page` 场景
2. 点击任意游戏卡片的"加入购物车"按钮
3. 观察控制台输出，应该显示：
   ```
   游戏已添加到购物车: [游戏名称] (购物车中有 1 个游戏)
   ```
4. 点击购物车按钮进入 `Cart_Page` 场景
5. 验证游戏正确显示在购物车中

#### 方法二：使用测试助手脚本
1. 在 `Shop_Page` 场景中添加 `CartTestHelper` 脚本到任意游戏对象
2. 在Inspector中配置测试按钮和显示文本
3. 运行游戏，使用测试按钮：
   - "测试添加" - 添加测试游戏到购物车
   - "测试移除" - 从购物车移除测试游戏
   - "测试清空" - 清空整个购物车

### 4. 验证功能点

#### ✅ 添加功能测试
- [ ] 点击"加入购物车"按钮能成功添加游戏
- [ ] 重复添加同一游戏会被拒绝
- [ ] 购物车达到最大容量时拒绝添加新游戏
- [ ] 已购买的游戏无法添加到购物车

#### ✅ 移除功能测试
- [ ] 在购物车页面能正确移除单个游戏
- [ ] 移除后购物车计数正确更新
- [ ] 移除后总价正确计算

#### ✅ 清空功能测试
- [ ] 能一键清空所有购物车内容
- [ ] 清空后购物车显示为空状态

#### ✅ UI更新测试
- [ ] 添加游戏后购物车按钮数字正确更新
- [ ] 购物车页面正确显示所有游戏
- [ ] 价格计算正确（原价、折扣、最终价格）
- [ ] 购物车为空时显示空状态提示

#### ✅ 场景切换测试
- [ ] 从商城页面能正确跳转到购物车页面
- [ ] 从购物车页面能正确返回商城页面
- [ ] 场景切换后购物车数据保持

### 5. 调试方法

#### 控制台日志
购物车操作会在控制台输出详细日志：
```
游戏已添加到购物车: 太空冒险 (购物车中有 1 个游戏)
游戏已从购物车移除: 太空冒险 (购物车中有 0 个游戏)
```

#### 右键菜单调试
在 `ShoppingCart` 组件上右键选择 "Print Cart Contents" 可以查看当前购物车内容。

#### 测试助手调试
使用 `CartTestHelper` 脚本可以实时查看购物车状态和进行测试操作。

## 常见问题排查

### 问题1：ShoppingCart.Instance 为空错误
**错误信息：** `测试: ShoppingCart.Instance 为空`

**解决方案：**
1. **快速修复方法：**
   - 在场景中添加 `ShoppingCartSetupHelper` 脚本到任意游戏对象
   - 在Inspector中右键点击脚本，选择"设置购物车系统"
   - 系统会自动创建所有必要的管理器对象

2. **手动修复方法：**
   - 在Hierarchy中创建空游戏对象，命名为"ShoppingCart"
   - 添加 `ShoppingCart` 脚本组件
   - 重复上述步骤创建 `GameSceneManager`、`GameLibrary`、`GameDataManager` 对象

3. **验证修复：**
   - 运行游戏，检查控制台是否还有错误
   - 使用 `ShoppingCartSetupHelper` 的"检查系统状态"功能验证

### 问题2：点击"加入购物车"没有反应
**解决方案：**
- 检查 `ShoppingCart` 对象是否存在
- 检查 `GameCard` 的 `addToCartButton` 是否正确分配
- 查看控制台是否有错误信息

### 问题3：购物车页面显示为空
**解决方案：**
- 检查 `CartPageUI` 脚本是否正确分配了UI引用
- 确认 `cartItemPrefab` 预制体已正确分配
- 检查 `CartItemUI` 脚本是否正确添加到预制体

### 问题4：购物车计数不更新
**解决方案：**
- 检查 `StoreUI` 中的 `cartCountText` 是否正确分配
- 确认 `UpdateCartCount()` 方法被正确调用
- 检查 `ShoppingCart.OnCartChanged` 事件是否正常触发

### 问题5：场景切换失败
**解决方案：**
- 检查 `GameSceneManager` 对象是否存在
- 确认场景名称在 `Build Settings` 中正确配置
- 检查场景名称拼写是否正确

## 预期结果
成功测试后，你应该能够：
1. 在商城页面点击"加入购物车"按钮添加游戏
2. 看到购物车按钮上的数字实时更新
3. 点击购物车按钮进入购物车页面
4. 在购物车页面看到添加的游戏，包括图标、名称、价格
5. 能够移除单个游戏或清空整个购物车
6. 购物车为空时显示相应的提示信息

## 扩展功能建议
- 添加购物车数量限制提示
- 实现购物车数据持久化（保存到本地）
- 添加购物车动画效果
- 实现批量操作功能
