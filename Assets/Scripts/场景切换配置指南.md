# 场景切换功能配置指南

## 概述
已经为商城页面和购物车页面添加了完整的场景切换功能。现在所有按钮都可以正确跳转到对应的场景。

## 已添加的功能

### 🏪 商城页面按钮
1. **购物车按钮** - 跳转到购物车场景
2. **游戏库按钮** - 跳转到游戏库场景

### 🛒 购物车页面按钮
1. **继续购物按钮** - 返回商城场景
2. **跳转至支付按钮** - 跳转到支付场景

## 新增的脚本

### GameSceneManager.cs
- **作用**：统一管理所有场景切换
- **功能**：
  - 场景加载
  - 场景名称管理
  - 场景存在性检查
  - 单例模式，确保全局唯一

## Unity设置步骤

### 第一步：创建GameSceneManager对象

1. **创建GameObject**
   - 右键Hierarchy → Create Empty
   - 重命名为"GameSceneManager"

2. **添加脚本组件**
   - 选中GameSceneManager
   - Add Component → Scripts → GameSceneManager

3. **配置场景名称**
   - 在Inspector中找到GameSceneManager脚本
   - 设置Scene Names部分：
     - Store Scene Name: "StoreScene"
     - Cart Scene Name: "CartScene"  
     - Library Scene Name: "LibraryScene"
     - Checkout Scene Name: "CheckoutScene"

### 第二步：创建场景文件

1. **创建商城场景**
   - File → New Scene
   - 保存为"StoreScene.unity"

2. **创建购物车场景**
   - File → New Scene
   - 保存为"CartScene.unity"

3. **创建游戏库场景**
   - File → New Scene
   - 保存为"LibraryScene.unity"

4. **创建支付场景**
   - File → New Scene
   - 保存为"CheckoutScene.unity"

### 第三步：添加到Build Settings

1. **打开Build Settings**
   - File → Build Settings

2. **添加场景**
   - 将创建的所有场景拖拽到Scenes In Build列表中
   - 确保顺序正确：
     - 0: StoreScene
     - 1: CartScene
     - 2: LibraryScene
     - 3: CheckoutScene

## 脚本配置说明

### StoreUI脚本配置
- **Cart Scene Name**: 购物车场景名称
- **Library Scene Name**: 游戏库场景名称
- 现在使用GameSceneManager进行场景切换

### CartPageUI脚本配置
- **Store Scene Name**: 商城场景名称
- **Checkout Scene Name**: 支付场景名称
- 现在使用GameSceneManager进行场景切换

## 场景切换流程

### 商城页面 → 购物车页面
```
用户点击购物车按钮
→ StoreUI.OpenShoppingCart()
→ GameSceneManager.LoadCartScene()
→ SceneManager.LoadScene("CartScene")
```

### 商城页面 → 游戏库页面
```
用户点击游戏库按钮
→ StoreUI.OpenGameLibrary()
→ GameSceneManager.LoadLibraryScene()
→ SceneManager.LoadScene("LibraryScene")
```

### 购物车页面 → 商城页面
```
用户点击继续购物按钮
→ CartPageUI.OnContinueShoppingClicked()
→ GameSceneManager.LoadStoreScene()
→ SceneManager.LoadScene("StoreScene")
```

### 购物车页面 → 支付页面
```
用户点击跳转至支付按钮
→ CartPageUI.OnProceedToCheckoutClicked()
→ 检查购物车是否为空
→ GameSceneManager.LoadCheckoutScene()
→ SceneManager.LoadScene("CheckoutScene")
```

## 数据持久化

### 单例管理器保持数据
- **ShoppingCart**: 购物车数据在场景间保持
- **GameLibrary**: 游戏库数据在场景间保持
- **GameDataManager**: 游戏数据在场景间保持
- **GameSceneManager**: 场景管理器在场景间保持

### 使用DontDestroyOnLoad
所有管理器都使用DontDestroyOnLoad，确保数据在场景切换时不会丢失。

## 测试场景切换

### 测试步骤
1. 运行游戏
2. 在商城页面点击购物车按钮
3. 验证是否正确跳转到购物车页面
4. 在购物车页面点击继续购物按钮
5. 验证是否正确返回商城页面
6. 测试其他按钮的跳转功能

### 预期结果
- 所有按钮都能正确跳转到对应场景
- 购物车数据在场景间保持
- 游戏库数据在场景间保持
- 场景切换流畅，无错误

## 常见问题

### 问题1：场景切换失败
**症状**：点击按钮后没有跳转到其他场景

**解决方案**：
1. 检查GameSceneManager是否存在
2. 检查场景名称是否正确设置
3. 检查场景是否添加到Build Settings
4. 查看Console中的错误信息

### 问题2：数据丢失
**症状**：场景切换后购物车或游戏库数据丢失

**解决方案**：
1. 确保管理器对象使用DontDestroyOnLoad
2. 检查管理器是否正确设置为单例
3. 确保在场景中创建了管理器对象

### 问题3：场景名称错误
**症状**：Console显示"Scene name not set"错误

**解决方案**：
1. 在GameSceneManager中正确设置场景名称
2. 确保场景名称与Build Settings中的名称一致
3. 检查场景文件是否正确保存

## 扩展功能

### 添加场景切换动画
可以在GameSceneManager中添加场景切换动画：
```csharp
public void LoadSceneWithFade(string sceneName)
{
    // 添加淡入淡出效果
    StartCoroutine(FadeAndLoadScene(sceneName));
}
```

### 添加场景预加载
```csharp
public void PreloadScene(string sceneName)
{
    SceneManager.LoadSceneAsync(sceneName, LoadSceneMode.Additive);
}
```

现在你的场景切换功能已经完全配置好了！所有按钮都可以正确地在不同场景之间跳转。




